function getMonthCalendar(e,t,n,r){for(var i=0;i<xhr.length;i++){xhr[i].abort()}$("#container_all").parent().prepend('<div id="sfondo" class="modal_sfondo"></div>');$("#modal_loading").fadeIn();xhr.push($.ajax({url:"ajax/getMonthCalendar.php?month="+e+"&year="+t+"&calendar_id="+n+"&publickey="+r,success:function(e){$("#modal_loading").fadeOut();$("#sfondo").remove();$("#calendar_container").html(e);$(".day_white a").each(function(){if($(this).attr("over")==1){if($(this).attr("popup")==1){$(this).bind("mouseenter",function(e){fillSlotsPopup($(this).attr("year"),$(this).attr("month"),$(this).attr("day"),n);$("#box_slots").stop().fadeIn(0);$(this).css({"background-color":booking_day_white_bg_hover});$(this).children("div.day_number").css({color:booking_day_white_line1_color_hover});$(this).children("div.day_slots").css({color:booking_day_white_line2_color_hover});$(this).children("div.day_book").css({color:booking_day_white_line1_color_hover})});$(this).bind("mouseleave",function(){$("#box_slots").hide();$(this).css({"background-color":booking_day_white_bg});$(this).children("div.day_number").css({color:booking_day_white_line1_color});$(this).children("div.day_slots").css({color:booking_day_white_line2_color});$(this).children("div.day_book").css({color:booking_day_white_line1_color})});$(this).bind("mousemove",function(e){var t;var n;pageX=e.pageX-$("#container_all").offset().left;pageY=e.pageY-$("#container_all").offset().top;if(pageX-$("#box_slots").width()<0){newpageX=0}else if(pageX+$("#box_slots").width()>$("#container_all").width()){newpageX=pageX-$("#box_slots").width()-20}else{newpageX=pageX}if(pageY<0){newpageY=0}else if(pageY+$("#box_slots").height()+20>$("#container_all").height()){newpageY=pageY-$("#box_slots").height()-40}else{newpageY=pageY}if(newpageY+$("#container_all").offset().top<e.pageY){t=newpageY+$("#container_all").offset().top-20}else{t=newpageY+$("#container_all").offset().top+20}if(newpageX+$("#container_all").offset().left<e.pageX){n=newpageX+$("#container_all").offset().left-20}else{n=newpageX+$("#container_all").offset().left+20}t=t-$(window).scrollTop();n=n-$(window).scrollLeft();if(t<0){t=pageY+40}$("#box_slots").css({top:t+"px",left:n+"px"})})}$(this).bind("click",function(){$("#box_slots").stop().fadeOut();getBookingForm($(this).attr("year"),$(this).attr("month"),$(this).attr("day"),n,r)})}});$(".day_black a").each(function(){if($(this).attr("over")==1){if($(this).attr("popup")==1){$(this).bind("mouseenter",function(e){fillSlotsPopup($(this).attr("year"),$(this).attr("month"),$(this).attr("day"),n);$("#box_slots").stop().fadeIn(0);$(this).css({"background-color":booking_day_black_bg_hover});$(this).children("div.day_number").css({color:booking_day_black_line1_color_hover});$(this).children("div.day_slots").css({color:booking_day_black_line2_color_hover});$(this).children("div.day_book").css({color:booking_day_black_line1_color_hover})});$(this).bind("mouseleave",function(){$("#box_slots").hide();$(this).css({"background-color":booking_day_black_bg});$(this).children("div.day_number").css({color:booking_day_black_line1_color});$(this).children("div.day_slots").css({color:booking_day_black_line2_color});$(this).children("div.day_book").css({color:booking_day_black_line1_color})});$(this).bind("mousemove",function(e){var t;var n;pageX=e.pageX-$("#container_all").offset().left;pageY=e.pageY-$("#container_all").offset().top;if(pageX-$("#box_slots").width()<0){newpageX=0}else if(pageX+$("#box_slots").width()>$("#container_all").width()){newpageX=pageX-$("#box_slots").width()-20}else{newpageX=pageX}if(pageY<0){newpageY=0}else if(pageY+$("#box_slots").height()+20>$("#container_all").height()){newpageY=pageY-$("#box_slots").height()-40}else{newpageY=pageY}if(newpageY+$("#container_all").offset().top<e.pageY){t=newpageY+$("#container_all").offset().top-20}else{t=newpageY+$("#container_all").offset().top+20}if(newpageX+$("#container_all").offset().left<e.pageX){n=newpageX+$("#container_all").offset().left-20}else{n=newpageX+$("#container_all").offset().left+20}t=t-$(window).scrollTop();n=n-$(window).scrollLeft();if(t<0){t=pageY+40}$("#box_slots").css({top:t+"px",left:n+"px"})})}$(this).bind("click",function(){$("#box_slots").stop().fadeOut();getBookingForm($(this).attr("year"),$(this).attr("month"),$(this).attr("day"),n,r)})}});$("#box_slots").resize(function(){$(this).bind("mouseleave",function(){$("#box_slots").hide()});var e;var t;pageX=currentMousePos.x-$("#container_all").offset().left;pageY=currentMousePos.y-$("#container_all").offset().top;if(pageX-$("#box_slots").width()<0){newpageX=0}else if(pageX+$("#box_slots").width()>$("#container_all").width()){newpageX=pageX-$("#box_slots").width()-20}else{newpageX=pageX}if(pageY<0){newpageY=0}else if(pageY+$("#box_slots").height()+20>$("#container_all").height()){newpageY=pageY-$("#box_slots").height()-40}else{newpageY=pageY}if(newpageY+$("#container_all").offset().top<currentMousePos.y){e=newpageY+$("#container_all").offset().top-20}else{e=newpageY+$("#container_all").offset().top+20}if(newpageX+$("#container_all").offset().left<currentMousePos.x){t=newpageX+$("#container_all").offset().left-20}else{t=newpageX+$("#container_all").offset().left+20}e=e-$(window).scrollTop();t=t-$(window).scrollLeft();if(e<0){e=pageY+40}$("#box_slots").css({top:e+"px",left:t+"px"})})}}));getMonthName(e);getYearName(t)}function getYearName(e){$("#month_year").html(e);currentYear=e}function getPreviousMonth(e,t,n){if(n==-1){if(currentMonth==1){newYear=currentYear-1;newMonth=12}else{newYear=currentYear;newMonth=currentMonth-1}getMonthCalendar(newMonth,newYear,e,t)}else{var r=new Date;var i=r.getFullYear();var s=r.getMonth()+1;var o=n;if(s==1){todaynum=""+(i-1)+"10"}else{var u=s-o;var a=i;if(s<10){s="0"+s}if(u<1){a--;diff=0-u;u=12-diff;if(u<10){u="0"+u}}else if(u<10){u="0"+u}todaynum=""+a+""+u}if(currentMonth==1){newYear=currentYear-1;newMonth=12}else{newYear=currentYear;newMonth=currentMonth-1}var f=newYear;var l=newMonth;if(l<10){l="0"+l}newnum=""+f+""+l;if(newnum>=todaynum){getMonthCalendar(newMonth,newYear,e,t)}else{getMonthCalendar(s,i,e,t)}}}function getNextMonth(e,t,n){if(n==-1){if(currentMonth==12){newYear=currentYear+1;newMonth=1}else{newYear=currentYear;newMonth=currentMonth+1}getMonthCalendar(newMonth,newYear,e,t)}else{var r=new Date;var i=r.getFullYear();var s=r.getMonth()+1;var o=n;if(s==12){todaynum=""+(i+1)+"0"+o}else{var u=""+parseInt(s+o);var a=i;if(u<10){u="0"+u}else if(u>12){diff=u-12;u=diff;if(diff<10){u="0"+diff}a++}todaynum=""+a+""+u}if(currentMonth==12){newYear=currentYear+1;newMonth=1}else{newYear=currentYear;newMonth=currentMonth+1}var f=newYear;var l=newMonth;if(l<10){l="0"+l}newnum=""+f+""+l;if(newnum<=todaynum){getMonthCalendar(newMonth,newYear,e,t)}else{getMonthCalendar(s,i,e,t)}}}function fillSlotsPopup(e,t,n,r){for(var i=0;i<xhr.length;i++){xhr[i].abort()}$("#slots_popup").html('<img src="images/loading.gif">');xhr.push($.ajax({url:"ajax/fillSlotsPopup.php?year="+e+"&month="+t+"&day="+n+"&calendar_id="+r,success:function(e){arrData=e.split("|");$("#slots_popup").html(arrData[0]);$("#popup_title").html(arrData[1]);$("#slots_popup").parent().resize()}}))}function hideSlotsPopup(){$("#box_slots").fadeOut("slow")}function closeBooking(e,t,n,r){if(navigator.appName=="Microsoft Internet Explorer"){var i=$("#booking_container");var s=i.height();var o=i.css("height");i.animate({height:"1px"},100,function(){i.hide();i.height(s);i.css("height",o)});$("#calendar_container").fadeIn()}else{$("#calendar_container").slideDown();$("#booking_container").slideUp()}$("#month_nav").fadeIn();$("#calendar_select").fadeIn();$("#calendar_select_label").fadeIn();$("#category_select").fadeIn();$("#category_select_label").fadeIn();$("#name_days_container").fadeIn();var u=new Date;if(r>-1&&n>0){getMonthCalendar(r,n,e,t)}else{getMonthCalendar(u.getMonth()+1,u.getFullYear(),e,t)}}function hideResponse(e,t,year,month){$("#modal_response").fadeOut("slow");$("#sfondo").remove();document.forms[0].reset();closeBooking(e,t,year,month)}function getBookingForm(e,t,n,r,i){for(var s=0;s<xhr.length;s++){xhr[s].abort()}$("#container_all").parent().prepend('<div id="sfondo" class="modal_sfondo"></div>');$("#modal_loading").fadeIn();xhr.push($.ajax({url:"ajax/getBookingForm.php?year="+e+"&month="+t+"&day="+n+"&calendar_id="+r,success:function(e){$("#modal_loading").fadeOut();$("#sfondo").remove();if(navigator.appName=="Microsoft Internet Explorer"){var t=$("#calendar_container");var n=t.height();var r=t.css("height");t.animate({height:"1px"},100,function(){t.hide();t.height(n);t.css("height",r)});$("#booking_container").fadeIn()}else{$("#calendar_container").slideUp();$("#booking_container").slideDown()}dataArr=e.split("|");$("#slot_form").html(dataArr[0]);if(dataArr[1]==1){$("#prev").html("");$("#next").html('<a href="#"></a>')}$("#month_nav").fadeOut();$("#calendar_select").fadeOut();$("#calendar_select_label").fadeOut();$("#category_select").fadeOut();$("#category_select_label").fadeOut();$("#name_days_container").fadeOut();$("#captcha_error").fadeOut();if(i!=""){Recaptcha.create(i,"captcha",{theme:booking_recaptcha_style,callback:function(){$("#recaptcha_response_field").attr("tmt:required","true");$("#recaptcha_response_field").attr("tmt:message",dataArr[2])}})}}}))}var currentMousePos={x:-1,y:-1};$(document).mousemove(function(e){currentMousePos.x=e.pageX;currentMousePos.y=e.pageY});var xhr=new Array